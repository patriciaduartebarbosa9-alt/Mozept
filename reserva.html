<?php
require_once 'config.php';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="author" content="">
        <meta name="robots" content="">
        <link rel="canonical" href="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:image" content="">
        <meta property="og:url" content="">
        <meta property="og:type" content="">
        <meta name="twitter:card" content="">
        <meta name="twitter:title" content="">
        <meta name="twitter:description" content="">
        <meta name="twitter:image" content="">
    <!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">    
    <link rel="stylesheet" href="http://localhost/Mustache-website/assets/css/styles.css">
   

    
     <link rel="stylesheet" href="assets/css/styles.css">
       
    
  </head>
<body class="">
    
    <link rel="stylesheet" href="http://localhost/Mustache-website/assets/css/styles.css">
    <header class="header">
        <div class="logo">Moze</div>
    
        <nav class="nav">
            <a href="index.html">Inicial</a>
            <a href="reserva.html" class="active">Reservar</a>
            <a href="mensagens.html">Mensagens</a>
            <a href="blog.html">Blog</a>
            <a href="about.html">Sobre Nós</a>
        </nav>
    
        <div class="profile-menu-container" style="position: relative;">
            <button class="profile-btn" id="profile-btn" aria-label="Menu de Perfil" onclick="document.getElementById('profile-dropdown').classList.toggle('show')">
                <img src="https://i.pravatar.cc/64?img=12" alt="Perfil" class="profile-avatar">
            </button>
            <div class="profile-dropdown" id="profile-dropdown" style="display: none; position: absolute; right: 0; top: 100%; background: #fff; border: 1px solid #dbdbdb; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); min-width: 180px; z-index: 1000;">
                      
                      <button id="btn-logout" style="display: block; width: 100%; padding: 10px 16px; background: none; border: none; text-align: left; color: #ab2a2a; cursor: pointer;">Terminar Sessão</button>
                        <a href="perfil.html" style="display: block; padding: 10px 16px; color: #262626; text-decoration: none;">Ver Perfil</a>
                        <a href="registo.html" style="display: block; padding: 10px 16px; color: #262626; text-decoration: none;">Registar</a>
                        
            </div>
        </div>
        <script>
          document.addEventListener('click', function(event) {
            var dropdown = document.getElementById('profile-dropdown');
            var btn = document.getElementById('profile-btn');
            if (!btn.contains(event.target)) {
              dropdown.classList.remove('show');
              dropdown.style.display = 'none';
            } else {
              dropdown.style.display = dropdown.classList.contains('show') ? 'block' : 'none';
            }
          });
    
          // Terminar sessão com confirmação
          document.addEventListener('DOMContentLoaded', function() {
            var logoutBtn = document.getElementById('btn-logout');
            if (logoutBtn) {
              logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Tem a certeza que deseja terminar sessão?')) {
                  // Aqui pode adicionar lógica para terminar sessão no backend se necessário
                  window.location.href = 'registo.html';
                }
              });
            }
          });
        </script>
    </header>
    
    <script>
        const headerConfig = {
            navPrefix: '',
            userType: '',
            userId: 'null'
        };
    </script>
    <script src=""></script>    
    <main>
        

<section class="reservar-hero" style="background:#fdfcf9;min-height:100vh;display:flex;align-items:center;justify-content:center;">
  <div class="container" style="max-width:420px;width:100%;margin:auto;">
    <div class="hero-content" style="padding:32px 0;">
      <h1 style="font-size:2.6rem;font-weight:700;margin-bottom:32px;line-height:1.1;">
        Encontre aqui o seu fotografo
      </h1>

      <form id="search-form" style="display:flex;flex-direction:column;gap:18px;">
        <div style="display:flex;gap:12px;">
          <select id="distrito" style="flex:1;background:#f2f2f2;border:none;border-radius:8px;padding:14px 16px;">
            <option value="">Distrito</option>
            <option value="aveiro">Aveiro</option>
            <option value="braga">Braga</option>
            <option value="lisboa">Lisboa</option>
            <option value="porto">Porto</option>
          </select>

          <select id="concelho" style="flex:1;background:#f2f2f2;border:none;border-radius:8px;padding:14px 16px;" disabled>
            <option value="">Concelho</option>
          </select>
        </div>

        <select id="categoria" style="background:#f2f2f2;border:none;border-radius:8px;padding:14px 16px;">
          <option value="">Categoria</option>
          <option value="casamento">Casamento</option>
          <option value="evento">Evento</option>
          <option value="retrato">Retrato</option>
          <option value="produto">Produto</option>
        </select>

        <button type="submit" style="background:#7b0000;color:#fff;border:none;border-radius:8px;padding:12px;">
          Ver preços
        </button>
      </form>
    </div>
  </div>
</section>

<section id="results-section" style="display:none;min-height:60vh;">
  <div class="container" style="max-width:700px;margin:auto;">
    <div id="fotografos-grid"></div>
  </div>
</section>

<script>
const concelhosPorDistrito = {
  aveiro: ["Aveiro","Águeda","Anadia"],
  lisboa: ["Lisboa","Amadora","Sintra"],
  porto: ["Porto","Maia","Vila Nova de Gaia"]
};

const distritoSelect = document.getElementById('distrito');
const concelhoSelect = document.getElementById('concelho');

distritoSelect.addEventListener('change', () => {
  const distrito = distritoSelect.value;
  concelhoSelect.innerHTML = '<option value="">Concelho</option>';

  if (concelhosPorDistrito[distrito]) {
    concelhoSelect.disabled = false;
    concelhosPorDistrito[distrito].forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      concelhoSelect.appendChild(opt);
    });
  } else {
    concelhoSelect.disabled = true;
  }
});

async function fetchFotografo(filtros) {
  const res = await fetch('reserva.php', {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     body: JSON.stringify(filtros)
  });
  try {
    const res = await fetch('reserva.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(filtros)
    });
    if (!res.ok) return [];
    const text = await res.text();
    try {
      const data = JSON.parse(text);
      console.log('Filtros enviados:', filtros);
      console.log('Debug da resposta:', data.debug);
      return data.status === 'success' ? data.data : [];
    } catch (e) {
      console.error('Resposta não é JSON:', text);
      return [];
    }
  } catch (err) {
    console.error('Erro no fetch:', err);
    return [];
  }
    console.log('Filtros enviados:', filtros);
    console.log('Debug da resposta:', data.debug);
  return data.status === 'success' ? data.data : [];
}

document.getElementById('search-form').addEventListener('submit', async e => {
  e.preventDefault();
  document.getElementById('results-section').style.display = 'block';

  const filtros = {
    distrito: distritoSelect.options[distritoSelect.selectedIndex].text,
    concelho: concelhoSelect.options[concelhoSelect.selectedIndex].text,
    categoria: document.getElementById('categoria').value
  };

  const resultados = await fetchFotografo(filtros);
  const grid = document.getElementById('fotografos-grid');
  grid.innerHTML = resultados.length
    ? resultados.map(f => `
        <div class="fotografo-card" style="background:#fff;border-radius:16px;padding:18px 18px 12px 18px;box-shadow:0 2px 8px #0001;margin-bottom:24px;max-width:640px;display:block;">
            <div style="display:flex;align-items:center;justify-content:space-between;">
                <div style="display:flex;align-items:center;gap:16px;">
                    <img src="${f.imagemperfil ? '/uploads/' + f.imagemperfil : 'assets/img/default.jpg'}" alt="${f.nome}" style="width:56px;height:56px;border-radius:50%;object-fit:cover;">
                    <div>
                        <div style="font-weight:600;font-size:1.08rem;">${f.nome}</div>
                        <div style="color:#555;font-size:0.98rem;">${f.Concelho} • ${f.avaliacao || 0} <span style="color:#7b0000;">★</span></div>
                    </div>
                </div>
                <a href="perfilfotografo-publico.html?id=${encodeURIComponent(f.id)}" style="background:#7b0000;color:#fff;border:none;border-radius:8px;padding:8px 18px;font-weight:500;font-size:1rem;text-decoration:none;">Visitar perfil</a>
            </div>
        </div>
    `).join('')
    : '<p>Nenhum fotografo encontrado.</p>';
});
</script>

  
    </main>
    
    
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo"><small>&copy;</small>Moze</div>
            </div>
            <div class="footer-section">
                <h3>Empresa</h3>
                <ul class="footer-links">
                    <li><a href="about.html">Sobre nós</a></li>
                    <li><a href="contact.html">Contatos</a></li>
                    <li><a href="#">Política de Privacidade</a></li>
                    <li><a href="#">Termos e Condições</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Redes Sociais</h3>
                <ul class="footer-social">
                    <li><a href="https://www.instagram.com/moze.capture/">Instagram</a></li>
                    <li><a href="#">Twitter</a></li>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Linkedin</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <div class="footer-newsletter">Subscreva se à nossa Newsletter</div>
                <form class="newsletter-form">
                    <input type="email" class="newsletter-input" placeholder="Insira o seu e-mail" required>
                    <button type="submit" class="newsletter-btn">&#8594;</button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Moze. All rights reserved.</p>
        </div>
    </footer>    <!-- Bootstrap JS Bundle -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.0.0/mustache.min.js"></script>
    <script src="http://localhost/Mustache-website/assets/js/main.js"></script>
       
         <script>
         // Guardar o id do utilizador da query string em localStorage e manter em todas as páginas
         (function() {
             const params = new URLSearchParams(window.location.search);
             const userId = params.get('id');
             if (userId) {
                 localStorage.setItem('userId', userId);
             }
             window.getUserId = function() {
                 return localStorage.getItem('userId');
             };
             // Propagar o id do utilizador nos links de navegação
             document.addEventListener('DOMContentLoaded', function() {
                 const uid = localStorage.getItem('userId');
                 if (uid) {
                     document.querySelectorAll('nav.nav a').forEach(function(link) {
                         const url = new URL(link.href, window.location.origin);
                         url.searchParams.set('id', uid);
                         link.href = url.pathname + url.search;
                     });
                 }
                 // Adicionar evento de logout se existir botão/link com id="logout-btn"
                 const logoutBtn = document.getElementById('logout-btn');
                 if (logoutBtn) {
                     logoutBtn.addEventListener('click', function(e) {
                         localStorage.removeItem('userId');
                         // Opcional: redirecionar para login
                         window.location.href = 'login.html';
                     });
                 }
             });
         })();
         </script>
      
     <script>
     // Guardar o id do utilizador da query string em localStorage e manter em todas as páginas
     (function() {
         const params = new URLSearchParams(window.location.search);
         const userId = params.get('id');
         if (userId) {
             localStorage.setItem('userId', userId);
         }
         // Se não houver id na query mas existe em localStorage, garantir que está disponível
         window.getUserId = function() {
             return localStorage.getItem('userId');
         };
         // Propagar o id do utilizador nos links de navegação
         document.addEventListener('DOMContentLoaded', function() {
             const uid = localStorage.getItem('userId');
             if (uid) {
                 document.querySelectorAll('nav.nav a').forEach(function(link) {
                     const url = new URL(link.href, window.location.origin);
                     url.searchParams.set('id', uid);
                     link.href = url.pathname + url.search;
                 });
             }
         });
     })();
     </script>
     </body>
</html>
