<div class="edit-profile-container">
  <h2>Editar Perfil do Cliente</h2>
  <form id="edit-profile-form" method="post" enctype="multipart/form-data">
    <div class="form-group">
      <label for="profile-image">Imagem de Perfil</label>
      <input type="file" id="profile-image" name="profile-image" accept="image/*">
      <div class="profile-image-preview">
        <img id="preview-img" src="https://i.pravatar.cc/120?img=12" alt="Imagem de Perfil" style="width:120px;height:120px;border-radius:50%;object-fit:cover;">
      </div>
    </div>
    <div class="form-group">
      <label for="password">Nova Senha</label>
      <input type="password" id="password" name="password" placeholder="Nova senha" minlength="6">
    </div>
    <button type="submit" class="btn-save">Guardar Alterações</button>
  </form>
</div>
<script>
// Preview da imagem
const input = document.getElementById('profile-image');
const preview = document.getElementById('preview-img');
input.addEventListener('change', function() {
  const file = this.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
});

// Submeter dados para a base de dados
document.getElementById('edit-profile-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = new FormData();
  // Obter o ID do cliente
  const userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
  formData.append('id', userId);
  // Imagem de perfil
  const imgInput = document.getElementById('profile-image');
  if (imgInput && imgInput.files && imgInput.files[0]) {
    formData.append('imagemperfil', imgInput.files[0]);
  }
  // Nova senha
  const senha = document.getElementById('password').value;
  if (senha) {
    formData.append('senha', senha);
  }
  fetch('api/update_cliente.php', {
    method: 'POST',
    body: formData
  })
  .then(async r => {
    let text = await r.text();
    let resp;
    try {
      resp = JSON.parse(text);
    } catch (err) {
      alert('Erro ao processar resposta do servidor.');
      console.error('Resposta inválida:', text);
      return;
    }
    if (resp.sucesso) {
      alert('Perfil atualizado com sucesso!');
      window.location.href = 'perfilcliente.html?id=' + userId;
    } else {
      alert('Erro ao atualizar perfil: ' + (resp.erro || ''));
      console.error('Erro ao atualizar perfil:', resp);
    }
  })
  .catch(err => {
    alert('Erro de rede ao salvar perfil.');
    console.error('Erro de rede:', err);
  });
});
</script>
<style>
.edit-profile-container {
  max-width: 420px;
  margin: 40px auto;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  padding: 32px 24px;
}
.edit-profile-container h2 {
  margin-bottom: 24px;
  color: #7b0000;
  font-size: 1.5rem;
}
.form-group {
  margin-bottom: 24px;
}
.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
}
.profile-image-preview {
  margin-top: 8px;
}
.btn-save {
  background: #7b0000;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 12px 32px;
  font-size: 1rem;
  cursor: pointer;
}
.btn-save:hover {
  background: #ab2a2a;
}
</style>
