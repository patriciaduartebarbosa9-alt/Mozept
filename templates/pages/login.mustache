{{< minimal}}
{{$main}}
<main class="register-main">
  <div class="register-container">
    <div class="register-form-side">
      <h2 style="margin-bottom: 18px;">Entrar</h2>
      <div class="register-socials" style="margin-bottom: 18px;">
        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
        <a href="#" aria-label="X"><i class="fab fa-x-twitter"></i></a>
        <a href="#" aria-label="Google"><i class="fab fa-google"></i></a>
      </div>
        <form class="register-form" id="login-form">
        <label>Email*
          <input type="email" name="email" placeholder="email" required>
        </label>
        <label>Password*
          <div class="password-field">
            <input type="password" name="password" placeholder="password" id="login-password" required>
            <span class="toggle-password" onclick="togglePassword()"><i class="fa fa-eye"></i></span>
          </div>
        </label>
        <button type="submit" class="register-btn">Entrar</button>
      </form>
      <div id="login-error" style="color:#b00;margin-top:12px;"></div>
    </div>
    <div class="register-welcome">
      <h1>Olá!</h1>
      <p>Se ainda não se registou no nosso website<br>pode clicar aqui.</p>
      <a href="registo.html" class="register-btn-outline">Registar</a>
    </div>
  </div>
</main>
<script>

function togglePassword() {
  const pwd = document.getElementById('login-password');
  const icon = document.querySelector('.toggle-password i');
  if (pwd.type === 'password') {
    pwd.type = 'text';
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    pwd.type = 'password';
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}

document.getElementById('login-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const email = this.email.value.trim();
  const password = this.password.value;
  const errorDiv = document.getElementById('login-error');
  errorDiv.textContent = '';

  const res = await fetch('login.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  const data = await res.json();
  if (data.status === 'success') {
    // Redireciona para index.html com o id do utilizador
    window.location.href = 'index.html?id=' + encodeURIComponent(data.data.id);
  } else {
    errorDiv.textContent = data.message || 'Erro ao fazer login.';
  }
});

</script>
{{/main}}
{{/minimal}}
