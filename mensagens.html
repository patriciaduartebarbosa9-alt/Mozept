<?php
require_once 'config.php';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="author" content="">
        <meta name="robots" content="">
        <link rel="canonical" href="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:image" content="">
        <meta property="og:url" content="">
        <meta property="og:type" content="">
        <meta name="twitter:card" content="">
        <meta name="twitter:title" content="">
        <meta name="twitter:description" content="">
        <meta name="twitter:image" content="">
    <!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">    
    <link rel="stylesheet" href="http://localhost/Mustache-website/assets/css/styles.css">
   

    
     <link rel="stylesheet" href="assets/css/styles.css">
       
    
  </head>
<body class="">
    
    <link rel="stylesheet" href="http://localhost/Mustache-website/assets/css/styles.css">
    <header class="header">
        <div class="logo">Moze</div>
    
        <nav class="nav">
            <a href="index.html">Inicial</a>
            <a href="reserva.html">Reservar</a>
            <a href="mensagens.html" class="active">Mensagens</a>
            <a href="blog.html">Blog</a>
            <a href="about.html">Sobre N칩s</a>
        </nav>
    
        <div class="profile-menu-container" style="position: relative;">
            <button class="profile-btn" id="profile-btn" aria-label="Menu de Perfil" onclick="document.getElementById('profile-dropdown').classList.toggle('show')">
                <img src="https://i.pravatar.cc/64?img=12" alt="Perfil" class="profile-avatar">
            </button>
            <div class="profile-dropdown" id="profile-dropdown" style="display: none; position: absolute; right: 0; top: 100%; background: #fff; border: 1px solid #dbdbdb; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); min-width: 180px; z-index: 1000;">
                      
                      <button id="btn-logout" style="display: block; width: 100%; padding: 10px 16px; background: none; border: none; text-align: left; color: #ab2a2a; cursor: pointer;">Terminar Sess칚o</button>
                        <a href="perfil.html" style="display: block; padding: 10px 16px; color: #262626; text-decoration: none;">Ver Perfil</a>
                        <a href="registo.html" style="display: block; padding: 10px 16px; color: #262626; text-decoration: none;">Registar</a>
                        
            </div>
        </div>
        <script>
          document.addEventListener('click', function(event) {
            var dropdown = document.getElementById('profile-dropdown');
            var btn = document.getElementById('profile-btn');
            if (!btn.contains(event.target)) {
              dropdown.classList.remove('show');
              dropdown.style.display = 'none';
            } else {
              dropdown.style.display = dropdown.classList.contains('show') ? 'block' : 'none';
            }
          });
    
          // Terminar sess칚o com confirma칞칚o
          document.addEventListener('DOMContentLoaded', function() {
            var logoutBtn = document.getElementById('btn-logout');
            if (logoutBtn) {
              logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Tem a certeza que deseja terminar sess칚o?')) {
                  // Aqui pode adicionar l칩gica para terminar sess칚o no backend se necess치rio
                  window.location.href = 'registo.html';
                }
              });
            }
          });
        </script>
    </header>
    
    <script>
        const headerConfig = {
            navPrefix: '',
            userType: '',
            userId: 'null'
        };
    </script>
    <script src=""></script>    
    <main>
        
        <style>
        </style>
        <div class="messaging-container">
            <div class="sidebar">
                <div class="search-box">
                    <input type="text" placeholder="Pesquisar" class="search-input" id="search-input">
                </div>
                <div class="conversations-list" id="conversations-list">
                    <!-- Conversas aparecem aqui -->
                </div>
            </div>
            <div class="chat-area">
                <div class="chat-header" id="chat-header" style="display:none;">
                    <div class="chat-header-info">
                        <img src="" alt="" class="chat-avatar" id="chat-avatar">
                        <div>
                            <h3 class="chat-user-name" id="chat-user-name"></h3>
                            <p class="chat-status">Online</p>
                        </div>
                    </div>
                </div>
                <div class="messages-container" id="messages-container" style="display:none;">
                    <div class="messages-list" id="messages-list"></div>
                </div>
                <div class="message-input-area" id="message-input-area" style="display:none;">
                    <div class="input-wrapper">
                        <button class="input-btn" id="upload-btn">
                            <span>游늹</span>
                        </button>
                        <input type="file" id="file-input" style="display: none;">
                        <input type="text" placeholder="Escreva a sua mensagem..." class="message-input" id="message-input">
                        <button class="input-btn send-btn" id="send-btn">
                            <span>游닋</span>
                        </button>
                    </div>
                </div>
                <div class="empty-state" id="empty-state">
                    <h2>As tuas mensagens</h2>
                    <p>Recebe e envia mensagens sobre os teus servi칞os.</p>
                </div>
            </div>
        </div>
        <script>
        // Dados de exemplo
        const conversations = [
            {
                id: 1,
                name: "Rodrigo Silva",
                avatar: "https://i.pravatar.cc/48?img=1",
                last: "Combinado! Qualquer d칰vida, 칠 s칩 dizer.",
                messages: [
                    { from: "other", text: "Ol치! Est치 tudo certo, sim 游녨" },
                    { from: "user", text: "Ol치!  Queria s칩 confirmar se est치 tudo certo para o dia 18." },
                    { from: "user", text: "Perfeito! Depois envio-lhe o local mais especificamente." },
                    { from: "other", text: "Combinado! Qualquer d칰vida, 칠 s칩 dizer." }
                ]
            },
            {
                id: 2,
                name: "Ana Ribeiro",
                avatar: "https://i.pravatar.cc/48?img=2",
                last: "J치 recebi os retratos.",
                messages: [
                    { from: "other", text: "J치 recebi os retratos." }
                ]
            },
            {
                id: 3,
                name: "Rafael Tavares",
                avatar: "https://i.pravatar.cc/48?img=3",
                last: "Obrigado pela confian칞a!",
                messages: [
                    { from: "other", text: "Obrigado pela confian칞a!" }
                ]
            }
        ];

        function renderConversations(list) {
            const el = document.getElementById('conversations-list');
            el.innerHTML = list.map(conv => `
                <div class="conversation-item" data-id="${conv.id}">
                    <img src="${conv.avatar}" alt="${conv.name}" class="avatar">
                    <div class="conversation-info">
                        <h3>${conv.name}</h3>
                        <p>${conv.last}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderMessages(conv) {
            const el = document.getElementById('messages-list');
            el.innerHTML = conv.messages.map(msg => `
                <div class="message-bubble ${msg.from}">${msg.text}</div>
            `).join('');
        }

        function showChat(conv) {
            document.getElementById('chat-header').style.display = '';
            document.getElementById('messages-container').style.display = '';
            document.getElementById('message-input-area').style.display = '';
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('chat-avatar').src = conv.avatar;
            document.getElementById('chat-user-name').textContent = conv.name;
            renderMessages(conv);
        }

        function showEmpty() {
            document.getElementById('chat-header').style.display = 'none';
            document.getElementById('messages-container').style.display = 'none';
            document.getElementById('message-input-area').style.display = 'none';
            document.getElementById('empty-state').style.display = '';
        }

        // Inicializa칞칚o
        renderConversations(conversations);
        showEmpty();

        // Sele칞칚o de conversa
        document.getElementById('conversations-list').addEventListener('click', function(e) {
            const item = e.target.closest('.conversation-item');
            if (!item) return;
            const id = parseInt(item.dataset.id);
            document.querySelectorAll('.conversation-item').forEach(el => el.classList.remove('active'));
            item.classList.add('active');
            const conv = conversations.find(c => c.id === id);
            if (conv) showChat(conv);
        });

        // Pesquisa
        document.getElementById('search-input').addEventListener('input', function(e) {
            const val = e.target.value.toLowerCase();
            renderConversations(conversations.filter(c => c.name.toLowerCase().includes(val)));
        });

        // Envio de mensagem (apenas visual)
        document.getElementById('send-btn').addEventListener('click', function() {
            const input = document.getElementById('message-input');
            const txt = input.value.trim();
            if (!txt) return;
            const active = document.querySelector('.conversation-item.active');
            if (!active) return;
            const id = parseInt(active.dataset.id);
            const conv = conversations.find(c => c.id === id);
            conv.messages.push({ from: 'user', text: txt });
            renderMessages(conv);
            input.value = '';
        });
        </script>

    </main>
    
    
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo"><small>&copy;</small>Moze</div>
            </div>
            <div class="footer-section">
                <h3>Empresa</h3>
                <ul class="footer-links">
                    <li><a href="about.html">Sobre n칩s</a></li>
                    <li><a href="contact.html">Contatos</a></li>
                    <li><a href="#">Pol칤tica de Privacidade</a></li>
                    <li><a href="#">Termos e Condi칞칫es</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Redes Sociais</h3>
                <ul class="footer-social">
                    <li><a href="https://www.instagram.com/moze.capture/">Instagram</a></li>
                    <li><a href="#">Twitter</a></li>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Linkedin</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <div class="footer-newsletter">Subscreva se  nossa Newsletter</div>
                <form class="newsletter-form">
                    <input type="email" class="newsletter-input" placeholder="Insira o seu e-mail" required>
                    <button type="submit" class="newsletter-btn">&#8594;</button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Moze. All rights reserved.</p>
        </div>
    </footer>    <!-- Bootstrap JS Bundle -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.0.0/mustache.min.js"></script>
    <script src="http://localhost/Mustache-website/assets/js/main.js"></script>
       
         <script>
         // Guardar o id do utilizador da query string em localStorage e manter em todas as p치ginas
         (function() {
             const params = new URLSearchParams(window.location.search);
             const userId = params.get('id');
             if (userId) {
                 localStorage.setItem('userId', userId);
             }
             window.getUserId = function() {
                 return localStorage.getItem('userId');
             };
             // Propagar o id do utilizador nos links de navega칞칚o
             document.addEventListener('DOMContentLoaded', function() {
                 const uid = localStorage.getItem('userId');
                 if (uid) {
                     document.querySelectorAll('nav.nav a').forEach(function(link) {
                         const url = new URL(link.href, window.location.origin);
                         url.searchParams.set('id', uid);
                         link.href = url.pathname + url.search;
                     });
                 }
                 // Adicionar evento de logout se existir bot칚o/link com id="logout-btn"
                 const logoutBtn = document.getElementById('logout-btn');
                 if (logoutBtn) {
                     logoutBtn.addEventListener('click', function(e) {
                         localStorage.removeItem('userId');
                         // Opcional: redirecionar para login
                         window.location.href = 'login.html';
                     });
                 }
             });
         })();
         </script>
      
     <script>
     // Guardar o id do utilizador da query string em localStorage e manter em todas as p치ginas
     (function() {
         const params = new URLSearchParams(window.location.search);
         const userId = params.get('id');
         if (userId) {
             localStorage.setItem('userId', userId);
         }
         // Se n칚o houver id na query mas existe em localStorage, garantir que est치 dispon칤vel
         window.getUserId = function() {
             return localStorage.getItem('userId');
         };
         // Propagar o id do utilizador nos links de navega칞칚o
         document.addEventListener('DOMContentLoaded', function() {
             const uid = localStorage.getItem('userId');
             if (uid) {
                 document.querySelectorAll('nav.nav a').forEach(function(link) {
                     const url = new URL(link.href, window.location.origin);
                     url.searchParams.set('id', uid);
                     link.href = url.pathname + url.search;
                 });
             }
         });
     })();
     </script>
     </body>
</html>
