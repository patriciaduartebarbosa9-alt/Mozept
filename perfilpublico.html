<?php
require_once 'config.php';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="author" content="">
        <meta name="robots" content="">
        <link rel="canonical" href="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:image" content="">
        <meta property="og:url" content="">
        <meta property="og:type" content="">
        <meta name="twitter:card" content="">
        <meta name="twitter:title" content="">
        <meta name="twitter:description" content="">
        <meta name="twitter:image" content="">
    <!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">    
    <link rel="stylesheet" href="http://localhost/Mustache-website/assets/css/styles.css">
   

    
     <link rel="stylesheet" href="assets/css/styles.css">
       
    
  </head>
<body class="">
    <link rel="stylesheet" href="http://localhost/Mustache-website/assets/css/styles.css">
    <header class="header">
        <div class="logo">Moze</div>
    
        <nav class="nav">
            <a href="index.html">Inicial</a>
            <a href="reserva.html">Reservar</a>
            <a href="mensagens.html">Mensagens</a>
            <a href="blog.html">Blog</a>
            <a href="about.html">Sobre N√≥s</a>
        </nav>
    
        <div class="profile-menu-container" style="position: relative;">
            <button class="profile-btn" id="profile-btn" aria-label="Menu de Perfil" onclick="document.getElementById('profile-dropdown').classList.toggle('show')">
                <img id="header-avatar" src="https://i.pravatar.cc/64?img=12" alt="Perfil" class="profile-avatar">
              <script>
              // Mostrar/ocultar 'Ver Perfil' dinamicamente
              document.addEventListener('DOMContentLoaded', function() {
                var perfilLink = document.getElementById('ver-perfil-link');
                var userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
                if (perfilLink) {
                  if (!userId) {
                    perfilLink.style.display = 'none';
                  } else {
                    perfilLink.style.display = 'block';
                  }
                }
              });
              // Propagar o id nos links de navega√ß√£o para p√°ginas privadas
              document.addEventListener('DOMContentLoaded', function() {
                var userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
                if (userId) {
                  document.querySelectorAll('nav.nav a').forEach(function(link) {
                    var url = new URL(link.href, window.location.origin);
                    // S√≥ propaga id se for p√°gina privada
                    if (url.pathname.includes('perfil.html') || url.pathname.includes('mensagens.html') || url.pathname.includes('reserva.html')) {
                      url.searchParams.set('id', userId);
                      link.href = url.pathname + url.search;
                    } else {
                      // Para p√°ginas p√∫blicas, remove id
                      url.searchParams.delete('id');
                      link.href = url.pathname + url.search;
                    }
                  });
                }
              });
              // Buscar imagem de perfil da BD em tempo real para o header
              document.addEventListener('DOMContentLoaded', function() {
                var img = document.getElementById('header-avatar');
                // Fun√ß√£o para obter o ID do utilizador autenticado
                function getUserId() {
                  return localStorage.getItem('userId') || sessionStorage.getItem('userId');
                }
                var userId = getUserId();
                if (img && userId) {
                  fetch('api/fotografo_perfil.php?id=' + encodeURIComponent(userId))
                    .then(async r => {
                      const text = await r.text();
                      try {
                        const f = JSON.parse(text);
                        if (f.imagemperfil) {
                          img.src = f.imagemperfil;
                        }
                      } catch (e) {
                        // Se erro, mant√©m imagem padr√£o
                      }
                    });
                }
              });
              </script>
            </button>
            <div class="profile-dropdown" id="profile-dropdown" style="display: none; position: absolute; right: 0; top: 100%; background: #fff; border: 1px solid #dbdbdb; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); min-width: 180px; z-index: 1000;">
                      
                      <button id="btn-logout" style="display: block; width: 100%; padding: 10px 16px; background: none; border: none; text-align: left; color: #ab2a2a; cursor: pointer;">Terminar Sess√£o</button>
                        <a href="#" id="ver-perfil-link" style="display: block; padding: 10px 16px; color: #262626; text-decoration: none;">Ver Perfil</a>
                        <hr style="margin: 0;">
            </div>
        </div>
        <script>
          document.addEventListener('click', function(event) {
            var dropdown = document.getElementById('profile-dropdown');
            var btn = document.getElementById('profile-btn');
            if (!btn.contains(event.target)) {
              dropdown.classList.remove('show');
              dropdown.style.display = 'none';
            } else {
              dropdown.style.display = dropdown.classList.contains('show') ? 'block' : 'none';
            }
          });
    
          // Terminar sess√£o com confirma√ß√£o
          document.addEventListener('DOMContentLoaded', function() {
            var logoutBtn = document.getElementById('btn-logout');
            if (logoutBtn) {
              logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Tem a certeza que deseja terminar sess√£o?')) {
                  localStorage.removeItem('userId');
                  sessionStorage.removeItem('userId');
                  window.location.href = 'registo.html';
                }
              });
            }
            // Corrigir link Ver Perfil para propagar id
            var perfilLink = document.getElementById('ver-perfil-link');
            var userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
            if (perfilLink) {
              perfilLink.addEventListener('click', function(e) {
                e.preventDefault();
                if (!userId) {
                  window.location.href = 'login.html';
                  return;
                }
                window.location.href = 'perfil.html?id=' + userId;
              });
            }
          });
        </script>
    </header>
    
    <script>
        const headerConfig = {
            navPrefix: '',
            userType: '',
            userId: 'null'
        };
    </script>
    <script src=""></script>    
    <main>
        
<script>
    const headerConfig = {
        navPrefix: '',
        userType: '',
        userId: null
    };
</script>
<main class="profile-page">
  <!-- PERFIL -->
  <section class="profile-card">
    <img src="https://i.pravatar.cc/80?img=32" class="avatar" alt="Avatar">
    <div class="profile-info">
      <h2>Sofia Martins</h2>
      <p>Fot√≥grafo Profissional Especializado em Fotografia de Est√∫dio</p>
      <div class="meta">
        <span>‚≠ê 4.2 (127 avalia√ß√µes)</span>
        <span>Matosinhos, Porto</span>
      </div>
    </div>
    <button class="edit-btn" onclick="window.location.href='mensagens.html'">Contactar</button>
  </section>
  <!-- TABS -->
  <section class="tabs">
    <button class="tab-btn" id="portfolio-tab-btn" data-tab="portfolio">Portf√≥lio</button>
    <button class="tab-btn" data-tab="servicos">Servi√ßos</button>
    <button class="tab-btn" data-tab="avaliacoes">Avalia√ß√µes</button>
  </section>
  <!-- CONTE√öDO DAS TABS -->
  <section class="tab-content">
    <!-- PORTF√ìLIO -->
<div id="portfolio" class="tab-panel active">
  

  <button class="edit-btn" id="add-portfolio-item"
    style="background:#eee; color:#7b0000; margin-left:12px; display:none;">
    Adicionar
  </button>

  <div style="display:flex; justify-content:center; background:#fcfaf7;
              border-radius:0 0 24px 24px; padding:32px 0;">
    <div class="portfolio portfolio-grid" id="portfolio-items"
         style="background:transparent; padding:0; border-radius:0;">
    </div>
  </div>
</div>

<script>

// Esconde portf√≥lio se userType for cliente
document.addEventListener('DOMContentLoaded', function() {
  const userType = localStorage.getItem('userType');
  const portfolioTabBtn = document.getElementById('portfolio-tab-btn');
  const portfolioPanel = document.getElementById('portfolio');
  if (userType === 'cliente') {
    if (portfolioTabBtn) portfolioTabBtn.style.display = 'none';
    if (portfolioPanel) portfolioPanel.style.display = 'none';
  }
});

let portfolioEditMode = false;
const editBtn = document.getElementById('edit-portfolio-btn');
const addBtn = document.getElementById('add-portfolio-item');
const portfolioItems = document.getElementById('portfolio-items');

let portfolioData = [
  {img:'https://picsum.photos/400/400?1', nome:'Projeto 1', desc:'Descri√ß√£o 1'},
  {img:'https://picsum.photos/400/400?2', nome:'Projeto 2', desc:'Descri√ß√£o 2'},
  {img:'https://picsum.photos/400/400?3', nome:'Projeto 3', desc:'Descri√ß√£o 3'},
  {img:'https://picsum.photos/400/400?4', nome:'Projeto 4', desc:'Descri√ß√£o 4'},
  {img:'https://picsum.photos/400/400?5', nome:'Projeto 5', desc:'Descri√ß√£o 5'},
  {img:'https://picsum.photos/400/400?6', nome:'Projeto 6', desc:'Descri√ß√£o 6'}
];

function renderPortfolio() {
  portfolioItems.innerHTML = '';

  portfolioData.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'portfolio-item';
    div.style = 'position:relative; text-align:center;';

    if (portfolioEditMode) {
      div.innerHTML = `
        <div style="position:relative; display:inline-block; margin-bottom:16px;">
          <label style="cursor:pointer;">
            <input type="file" accept="image/*" style="display:none;"
                   data-idx="${idx}" class="portfolio-img-input">
            <img src="${item.img}">
          </label>

          <button type="button" class="delete-img-btn"
                  style="position:absolute; top:8px; right:8px;
                  background:#fff; border:none; border-radius:50%;
                  width:32px; height:32px; cursor:pointer;">
            üóë
          </button>
        </div>

        <input type="text" value="${item.nome}"
               class="portfolio-name"
               style="width:100%; margin:10px 0; padding:8px;
               border-radius:6px; border:1px solid #ccc;">

        <textarea class="portfolio-desc"
                  style="width:100%; padding:8px;
                  border-radius:6px; border:1px solid #ccc;">
          ${item.desc}
        </textarea>

        <button type="button" class="remove-portfolio-item"
                style="margin-top:8px;">
          Remover
        </button>
      `;

      div.querySelector('.delete-img-btn').onclick = () => {
        portfolioData.splice(idx, 1);
        renderPortfolio();
      };

      div.querySelector('.portfolio-img-input').onchange = function () {
        if (this.files[0]) {
          const reader = new FileReader();
          reader.onload = e => {
            portfolioData[idx].img = e.target.result;
            renderPortfolio();
          };
          reader.readAsDataURL(this.files[0]);
        }
      };

      div.querySelector('.portfolio-name').oninput =
        e => portfolioData[idx].nome = e.target.value;

      div.querySelector('.portfolio-desc').oninput =
        e => portfolioData[idx].desc = e.target.value;

      div.querySelector('.remove-portfolio-item').onclick = () => {
        portfolioData.splice(idx, 1);
        renderPortfolio();
      };

    } else {
      div.innerHTML = `<img src="${item.img}">`;
    }

    portfolioItems.appendChild(div);
  });
}

editBtn.onclick = () => {
  portfolioEditMode = !portfolioEditMode;
  addBtn.style.display = portfolioEditMode ? 'inline-block' : 'none';
  editBtn.textContent = portfolioEditMode
    ? 'Concluir Edi√ß√£o'
    : 'Editar Portf√≥lio';
  renderPortfolio();
};

addBtn.onclick = () => {
  portfolioData.push({
    img:'https://picsum.photos/400/400?random='+Math.random(),
    nome:'', desc:''
  });
  renderPortfolio();
};

window.addEventListener('DOMContentLoaded', () => {
  addBtn.style.display = 'none';
  renderPortfolio();
});
</script>

<style>

</style>
    <!-- SERVI√áOS -->
    <div id="servicos" class="tab-panel">
      
      <ul class="services">
        
        <li>üßë‚Äçüíº Retratos Profissionais</li>
        <li>üè¢ Fotografia Corporativa</li>
      </ul>
    </div>
    <!-- AVALIA√á√ïES -->
    <div id="avaliacoes" class="tab-panel">
      
      <div class="review">
        <p>Fotos incr√≠veis, recomendo.</p>
        <span>‚Äî Mariana Gomes</span>
      </div>
    </div>
  </section>
    </main>
<script>
  // Altern√¢ncia de abas do perfil
  document.addEventListener('DOMContentLoaded', function() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanels = document.querySelectorAll('.tab-panel');
    tabBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        // Remove ativo de todos os bot√µes e pain√©is
        tabBtns.forEach(b => b.classList.remove('active'));
        tabPanels.forEach(panel => panel.classList.remove('active'));
        // Ativa o bot√£o e painel correspondente
        btn.classList.add('active');
        const tab = btn.getAttribute('data-tab');
        document.getElementById(tab).classList.add('active');
      });
    });
  });
</script>


    </main>
    
    
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo"><small>&copy;</small>Moze</div>
            </div>
            <div class="footer-section">
                <h3>Empresa</h3>
                <ul class="footer-links">
                    <li><a href="about.html">Sobre n√≥s</a></li>
                    <li><a href="contact.html">Contatos</a></li>
                    <li><a href="#">Pol√≠tica de Privacidade</a></li>
                    <li><a href="#">Termos e Condi√ß√µes</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Redes Sociais</h3>
                <ul class="footer-social">
                    <li><a href="https://www.instagram.com/moze.capture/">Instagram</a></li>
                    <li><a href="#">Twitter</a></li>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Linkedin</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <div class="footer-newsletter">Subscreva se √† nossa Newsletter</div>
                <form class="newsletter-form">
                    <input type="email" class="newsletter-input" placeholder="Insira o seu e-mail" required>
                    <button type="submit" class="newsletter-btn">&#8594;</button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Moze. All rights reserved.</p>
        </div>
    </footer>    <!-- Bootstrap JS Bundle -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.0.0/mustache.min.js"></script>
    <script src="http://localhost/Mustache-website/assets/js/main.js"></script>
       
         <script>
         // Guardar o id do utilizador da query string em localStorage e manter em todas as p√°ginas
         (function() {
             const params = new URLSearchParams(window.location.search);
             const userId = params.get('id');
             // S√≥ atualizar localStorage se a p√°gina for perfil.html, edit-profile.html, reserva.html, mensagens.html
             const privPages = ['perfil.html', 'edit-profile.html', 'reserva.html', 'mensagens.html'];
             const isPriv = privPages.some(p => window.location.pathname.endsWith(p));
             if (userId && isPriv) {
                 localStorage.setItem('userId', userId);
             }
             window.getUserId = function() {
                 return localStorage.getItem('userId');
             };
             // Propagar o id do utilizador nos links de navega√ß√£o
             // Corrigir: nunca sobrescrever userId do localStorage ao navegar para p√°ginas p√∫blicas
             document.addEventListener('DOMContentLoaded', function() {
                 const uid = localStorage.getItem('userId');
                 if (uid) {
                     document.querySelectorAll('nav.nav a').forEach(function(link) {
                         const url = new URL(link.href, window.location.origin);
                         // S√≥ propaga id se for p√°gina privada (mensagens, reserva, perfil, etc.)
                         if (url.pathname.includes('perfil.html') || url.pathname.includes('mensagens.html') || url.pathname.includes('reserva.html')) {
                             url.searchParams.set('id', uid);
                             link.href = url.pathname + url.search;
                         } else {
                             // Para p√°ginas p√∫blicas, remove id
                             url.searchParams.delete('id');
                             link.href = url.pathname + url.search;
                         }
                     });
                 }
                 // Adicionar evento de logout se existir bot√£o/link com id="logout-btn"
                 const logoutBtn = document.getElementById('logout-btn');
                 if (logoutBtn) {
                     logoutBtn.addEventListener('click', function(e) {
                         localStorage.removeItem('userId');
                         window.location.href = 'login.html';
                     });
                 }
             });
         })();
         </script>
      
     <script>
     // Guardar o id do utilizador da query string em localStorage e manter em todas as p√°ginas
     (function() {
         const params = new URLSearchParams(window.location.search);
         const userId = params.get('id');
         // S√≥ atualizar localStorage se a p√°gina for perfil.html, edit-profile.html, reserva.html, mensagens.html
         const privPages = ['perfil.html', 'edit-profile.html', 'reserva.html', 'mensagens.html'];
         const isPriv = privPages.some(p => window.location.pathname.endsWith(p));
         if (userId && isPriv) {
             localStorage.setItem('userId', userId);
         }
         // Se n√£o houver id na query mas existe em localStorage, garantir que est√° dispon√≠vel
         window.getUserId = function() {
             return localStorage.getItem('userId');
         };
         // Propagar o id do utilizador nos links de navega√ß√£o
         document.addEventListener('DOMContentLoaded', function() {
             const uid = localStorage.getItem('userId');
             if (uid) {
                 document.querySelectorAll('nav.nav a').forEach(function(link) {
                     const url = new URL(link.href, window.location.origin);
                     // S√≥ propaga id se for p√°gina privada (mensagens, reserva, perfil, etc.)
                     if (url.pathname.includes('perfil.html') || url.pathname.includes('mensagens.html') || url.pathname.includes('reserva.html')) {
                         url.searchParams.set('id', uid);
                         link.href = url.pathname + url.search;
                     } else {
                         // Para p√°ginas p√∫blicas, remove id
                         url.searchParams.delete('id');
                         link.href = url.pathname + url.search;
                     }
                 });
             }
         });
     })();
     </script>
     </body>
</html>
